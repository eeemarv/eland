{%- trans_default_domain 'mail' -%}

{%- macro html(c) -%}
	{%- set et = c.et -%}
	{%- include 'mail/include/p_header.html.twig' with {
		'p_header': 'periodic_overview.intersystem.title',
		'p_bgcolor': 'aa3300'
	} -%}

	{%- if c.intersystem -%}
		{%- include 'mail/include/info_bgcolor_panel.html.twig' with {
			'info': 'periodic_overview.intersystem.explain'|trans({
				'%link_open%': context_url_open('login', mpp_anon_ary(c.schema), {}),
				'%link_close%': '</a>'
			})|raw,
			'bgcolor': 'fff3a2'
		} -%}
	{%- endif -%}

{%- for i in c.intersystem -%}
	{%- embed 'mail/embed/table600.html.twig' -%}
		{%- trans_default_domain 'mail' -%}
		{%- block bgcolor -%}dd6633{%- endblock -%}
		{%- block td_top -%}10px{%- endblock -%}
		{%- block td_bottom -%}10px{%- endblock -%}
		{%- block td_style -%}font-size: 16px;color: #ffffff;{%- endblock -%}
		{%- block td_content -%}
			{{- 'periodic_overview.intersystem.system_name'|trans({
				'%name%': config_str('system.name', i.schema),
			}) -}}
		{%- endblock td_content -%}
	{%- endembed -%}

	{%- for msg in i.messages -%}
	{%- embed 'mail/embed/table600.html.twig' -%}
		{%- trans_default_domain 'mail' -%}
		{%- block bgcolor -%}
			{%- if loop.index is even -%}
				fff3a2
			{%- else -%}
				fff8cf
			{%- endif -%}
		{%- endblock -%}
		{%- block td_top -%}20px{%- endblock -%}
		{%- block td_bottom -%}20px{%- endblock -%}
		{%- block td_style -%}font-size: 16px;{%- endblock -%}
		{%- block td_content -%}
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td width="100" align="left" valign="top">
					{%- if msg.is_offer -%}
						{%- include 'mail/include/lbl_offer.html.twig' -%}
					{%- else -%}
						{%- include 'mail/include/lbl_want.html.twig' -%}
					{%- endif -%}
				</td>
				<td width="30">
				</td>
				<td align="left" valign="top">
					{{ msg.subject -}}
				</td>
			</tr>
			<tr>
				<td style="line-height: 0; padding-top: 5px; padding-bottom: 5px;">
					&nbsp;
				</td>
			</tr>
		</table>
		{%- if msg.postcode -%}
		<table bgcolor="#dddddd" border="0" style="font-size: 16px;padding-top:5px;padding-bottom:5px;padding-left:5px;" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td title="{{- 'label.postcode'|trans -}}">
					{{- 'label.postcode'|trans -}}:&nbsp;
					{{- msg.postcode -}}
				</td>
			</tr>
		</table>
		{%- endif -%}
		<table border="0" cellpadding="0" cellspacing="0" width="100%" style="font-size:16px;padding-top:5px;padding-bottom:5px;">
			<tr>
				<td>
					{{- 'periodic_overview.intersystem.account'|trans({
						'%account%': account(msg.user_id, i.schema),
						'%system_name%': config_str('system.name', i.schema)
					}) -}}
				</td>
			</tr>
		</table>
		{%- endblock td_content -%}
	{%- endembed -%}
	{%- endfor -%}
{%- endfor -%}
{%- endmacro html -%}

{% macro text(c) %}
{%- set et = c.et -%}
{% autoescape false %}

{% if c.intersystem %}

{{ 'periodic_overview.intersystem.title'|trans|underline }}

{% for i in c.intersystem %}

** {{ 'periodic_overview.intersystem.system_name'|trans({
			'%name%': i.system_name ?? config_str('system.name', i.schema),
}) }}

{% for msg in i.messages %}

{{ ('periodic_overview.intersystem.' ~ msg.offer_want)|trans({
	'%msg%': msg.subject
}) }}

{% if i.eland_server %}
	{{ 'periodic_overview.intersystem.account'|trans({
	'%account%': account(msg.user_id, i.schema),
	'%system_name%': config_str('system.name', i.schema)
}) }}
{% else %}
	{{ 'periodic_overview.intersystem.account'|trans({
	'%account%': msg.account,
	'%system_name%': i.system_name
}) }}
{% endif %}

{% endfor %}

{% endfor %}
{% endif %}
{% endautoescape %}
{% endmacro text %}
