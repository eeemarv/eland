{%- trans_default_domain 'mail' -%}

{% macro html(c) -%}
{%- set et = c.et -%}
<h3>
{{- 'periodic_overview.messages.title'|trans -}}
</h3>
{% if c.messages %}
<p>
{{- 'periodic_overview.messages.explain'|trans({
	'%link_open%': context_url_open('messages_extended', mpp_ary(c.user_id, c.schema), {}),
	'%link_close%': '</a>',
	'%days%': config_int('periodic_mail.days', c.schema)
})|raw -}}
</p>
<ul>
{% for msg in c.messages %}
<li>
	<strong>
		{{- context_url_open('messages_show', mpp_ary(c.user_id, c.schema), {'id': msg.id})|raw -}}
			{%- if msg.is_offer -%}
				{{- 'label.offer'|trans -}}
			{%- else -%}
				{{- 'label.want'|trans -}}
			{%- endif -%}:&nbsp;
			{{ msg.subject -}}
		</a>
	</strong>
<br />
{%- if msg.image_file -%}
	<br/>
	<img src="{{- s3_url(msg.image_file) -}}" height="200" alt="afbeelding">
	<br />
{%- endif -%}
{{- msg.content|raw -}}
<br />
{{- context_url_open('users_show', mpp_ary(c.user_id, c.schema),
	{'id': msg.user_id})|raw -}}
{{- account(msg.user_id, c.schema) -}}
</a>

{%- for mail in msg.mail -%}
	{%- if not loop.last -%}|{%- endif -%}&nbsp;
	<a href="mailto:{{- mail -}}?subject={{- msg.subject|url_encode -}}">
	{{- 'label.email'|trans -}}
	</a>
{%- endfor -%}
</li>
<br />
{%- endfor -%}
</ul>

{%- else -%}
<p>
{{- 'periodic_overview.messages.none'|trans({
	'%link_open%': context_url_open('messages_extended',
		mpp_ary(c.user_id, c.schema), {}),
	'%link_close%': '</a>'
})|raw -}}
</p>
{%- endif -%}

<p>
{{- 'periodic_overview.messages.add'|trans({
	'%link_open%': context_url_open('messages_add', mpp_ary(c.user_id, c.schema), {}),
	'%link_close%': '</a>'
})|raw -}}
</p>

{%- endmacro html -%}

{% macro text(c) %}
{%- set et = c.et -%}
{% autoescape false %}

{{ 'periodic_overview.messages.title'|trans|underline }}

{% if c.messages %}
{{ 'periodic_overview.messages.explain'|trans({
	'%link_open%': '',
	'%link_close%': '',
	'%days%': config_int('periodic_mail.days', c.schema)
}) }}
{% for msg in c.messages %}

{% if msg.is_offer -%}
	{{- 'label.offer'|trans -}}
{%- else -%}
	{{- 'label.want'|trans -}}
{%- endif -%}: {{ msg.subject }}
{{ context_url('messages_show', mpp_ary(c.user_id, c.schema), {'id': msg.id}) }}
{{ account(msg.user_id, c.schema) }}

{% endfor %}
{% else %}
{{ 'periodic_overview.messages.none'|trans({
	'%link_open%': '',
	'%link_close%': '',
	'%days%': config_int('periodic_mail.days', c.schema)
}) }}
{% endif %}

{{- 'periodic_overview.messages.add'|trans({
	'%link_open%': '',
	'%link_close%': ''
}) }}
{{ context_url('messages_add', mpp_ary(c.user_id, c.schema), {}) }}
{% endautoescape %}
{% endmacro text %}
