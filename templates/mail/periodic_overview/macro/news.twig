{%- trans_default_domain 'mail' -%}

{%- macro html(c) -%}
{%- set et = c.et -%}
<h3>
{{- 'periodic_overview.news.title'|trans({
	'%link_open%': context_url_open('news_extended', mpp_ary(c.user_id, c.schema), {}),
	'%link_close%': '</a>'
})|raw -}}
</h3>

{%- if c.news -%}
<ul>
{%- for n in c.news -%}
<li>
<h4>
{{- context_url_open('news_show', mpp_ary(c.user_id, c.schema), {'id': n.id})|raw -}}
{{- n.subject -}}
</a>
</h4>
{{- n.content|raw -}}<br />
{%- if n.location -%}
	{{- 'label.location'|trans -}}:
	&nbsp;<strong>
	{{- n.location -}}
	</strong>
	<br />
{%- endif -%}
{%- if n.event_at -%}
	{{- 'label.date'|trans -}}:
	&nbsp;<strong>
	{{ n.event_at|date_format('day', c.schema) }}
	</strong>
	<br />
{%- endif -%}
{{- 'periodic_overview.news.creator'|trans({
	'%link_open%': context_url_open('users_show', mpp_ary(c.user_id, c.schema), {'id': n.user_id}),
	'%link_close%': '</a>',
	'%account%': account(n.user_id, c.schema)
})|raw -}}
</li>

{%- endfor -%}
</ul>
{%- else -%}
	<p>
	{%- if c.block_options.news == 'recent' -%}
		{{- 'periodic_overview.news.no_recent'|trans -}}
	{%- else -%}
		{{- 'periodic_overview.news.none'|trans -}}
	{%- endif -%}
	</p>
{%- endif -%}

{%- endmacro html -%}

{% macro text(c) %}
{%- set et = c.et -%}
{% autoescape false %}

{{- 'periodic_overview.news.title'|trans({
	'%link_open%': '',
	'%link_close%': ''
})|underline }}
{% if c.news %}
{% for n in c.news %}

{{ n.subject|underline('.') }}

{{ n.content_plain_text }}

{% if n.location %}
{{ 'label.location'|trans }}: {{ n.location }}
{% endif %}
{% if n.event_at %}
{{ 'label.date'|trans }}: {{ n.event_at|date_format('day', c.schema) }}
{% endif %}
{{ 'periodic_overview.news.creator'|trans({
	'%link_open%': '',
	'%link_close%': '',
	'%account%': account(n.user_id, c.schema)
}) }}
{% endfor %}
{% else %}

{% if c.block_options.news == 'recent' %}
{{ 'periodic_overview.news.no_recent'|trans }}
{% else %}
{{ 'periodic_overview.news.none'|trans }}
{% endif %}
{% endif %}
{% endautoescape %}
{% endmacro text %}
