#!/usr/bin/env php
<?php

set_time_limit(0);

require_once __DIR__ . '/../include/app.php';

if (!$app instanceof Silex\Application)
{
    throw new LogicException('The bootstrap file must return
        an instance of Silex\Application.');
}

if (!isset($app['console']))
{
    throw new LogicException('The console service does not exist.
        Did you forget to register Knp\Provider\ConsoleServiceProvider ?');
}

if (getenv('APP_PORT'))
{
    $app['request_context']->setHttpPort(getenv('APP_PORT'));
}

if (getenv('APP_HOST'))
{
    $app['request_context']->setHost(getenv('APP_HOST'));
}

if (getenv('APP_SCHEME'))
{
    $app['request_context']->setScheme(getenv('APP_SCHEME'));
}

if (isset($app['locale']))
{
    $app['request_context']->setParameter('_locale', $app['locale']);
}

$app->flush();

$console = $app['console'];

$console->add(new command\process_cleanup_cache());
$console->add(new command\process_cleanup_images());
$console->add(new command\process_cleanup_logs());
$console->add(new command\process_fetch_elas_intersystem());
$console->add(new command\process_geocode());
$console->add(new command\process_log());
$console->add(new command\process_mail());
$console->add(new command\process_worker());
$console->add(new command\router_debug());

$console->run();
