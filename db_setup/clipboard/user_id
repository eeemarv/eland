user_id
----------

DO
$do$
DECLARE
  f_schema text;
BEGIN

FOR f_schema IN
    SELECT quote_ident(nspname)
    FROM   pg_namespace n
    WHERE  nspname !~~ 'pg_%'
    AND    nspname <>  'information_schema'
    AND    nspname <> 'xdb'
    AND    nspname <> 'c'
    AND    nspname <> 'e'
    AND    nspname <> 'migration'
    AND    nspname <> 'public'
LOOP
   EXECUTE 'SET LOCAL search_path = ' || f_schema;

   ALTER TABLE messages
        ADD COLUMN IF NOT EXISTS category_id int,
        ADD COLUMN IF NOT EXISTS user_id int not null default 0;

    UPDATE messages SET category_id = id_category;
    UPDATE messages SET user_id = id_user;

   ALTER TABLE news
        ADD COLUMN IF NOT EXISTS user_id int not null default 0;
    ALTER TABLE contact
        ADD COLUMN IF NOT EXISTS user_id int not null default 0;

    UPDATE news SET user_id = id_user;
    UPDATE contact SET user_id = id_user;

    ALTER TABLE messages
        ALTER COLUMN user_id DROP DEFAULT;
    ALTER TABLE news
        ALTER COLUMN user_id DROP DEFAULT;
    ALTER TABLE contact
        ALTER COLUMN user_id DROP DEFAULT;

END LOOP;

END
$do$






-----



DO
$do$
DECLARE
  f_schema text;
BEGIN

FOR f_schema IN
    SELECT quote_ident(nspname)
    FROM   pg_namespace n
    WHERE  nspname !~~ 'pg_%'
    AND    nspname <>  'information_schema'
    AND    nspname <> 'xdb'
    AND    nspname <> 'c'
    AND    nspname <> 'e'
    AND    nspname <> 'migration'
    AND    nspname <> 'public'
LOOP
   EXECUTE 'SET LOCAL search_path = ' || f_schema;

    ALTER TABLE messages
        DROP COLUMN id_user;
    ALTER TABLE news
        DROP COLUMN id_user;
    ALTER TABLE contact
        DROP COLUMN id_user;
    ALTER TABLE messages
        DROP COLUMN id_category;

END LOOP;

END
$do$
